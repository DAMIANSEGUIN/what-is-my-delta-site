<!doctype html>
<meta charset="utf-8">
<title>What Is My Delta — Find Your Next Career Move</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--fg:#000;--muted:#666;--line:#e8e8e8;--hair:#111;--max:980px;--api:'https://mosaic-platform.vercel.app'}
  *{box-sizing:border-box}
  html,body{margin:0;background:#fff;color:var(--fg)}
  body{font:12px/1.75 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  a:hover,a:focus{text-decoration:underline}
  .wrap{max-width:var(--max);margin:0 auto;padding:28px 20px}

  .nav{display:flex;gap:24px;margin-bottom:60px;flex-wrap:wrap;align-items:center}
  .hero{margin:120px 0 40px}
  .title{font:500 15px/1.4 Helvetica,Arial;letter-spacing:.02em}
  .sub{color:var(--muted);max-width:64ch}
  .actions{margin:24px 0 0;display:flex;gap:16px;align-items:center;flex-wrap:wrap}
  .quiet{border:1px solid var(--line);padding:6px 10px;background:#fff;cursor:pointer;font:inherit;transition:background 0.2s ease}
  .quiet:hover{background:#f8f8f8}
  .quiet:focus{outline:2px solid #0ea5e9;outline-offset:2px}

  svg.schema{display:block;width:100%;height:auto;margin:50px 0}
  .wire{stroke:var(--hair);stroke-width:.7;fill:none;stroke-linecap:round;stroke-linejoin:round}
  .dot{fill:var(--hair)}

  .rule{border-top:1px solid var(--line);margin:80px 0}
  .metrics{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px;margin:30px 0 90px}
  .card{border:1px solid var(--line);padding:14px;transition:box-shadow 0.2s ease}
  .card:hover{box-shadow:0 2px 8px rgba(0,0,0,0.1)}
  .k{color:var(--muted);text-transform:uppercase;letter-spacing:.08em;font-size:10px}
  .v{font-size:18px;font-weight:600;margin-top:4px}

  .island{margin:100px 0}
  .module{margin:70px 0;transition:transform 0.2s ease}
  .module:hover{transform:translateY(-1px)}
  .module h3{margin:0 0 6px;font:600 12px/1 Helvetica,Arial;text-transform:uppercase;letter-spacing:.06em}
  .module ul{list-style:none;margin:6px 0 0;padding:0;color:var(--muted)}
  .module li{margin:3px 0}
  textarea.small{width:100%;min-height:60px;border:1px solid var(--line);padding:8px;background:#fff;font:inherit;transition:border-color 0.2s ease}
  textarea.small:focus{border-color:#0ea5e9;outline:none}
  .module-actions{margin-top:8px;display:flex;gap:12px;flex-wrap:wrap}
  .module-actions a{color:var(--muted);font-size:11px;transition:color 0.2s ease}
  .module-actions a:hover{color:var(--fg)}

  .welcome-title{font:600 12px/1 Helvetica,Arial;text-transform:uppercase;letter-spacing:.08em}
  details.micro{margin-top:16px}
  details.micro summary{cursor:pointer;user-select:none}
  details.micro summary:hover{color:var(--muted)}

  .chat{position:fixed;right:20px;bottom:20px;width:320px;max-width:90vw;background:#fff;border:1px solid var(--line);box-shadow:0 8px 30px rgba(0,0,0,.06);display:none;z-index:1000;border-radius:8px;overflow:hidden}
  .chat header{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--line);background:#f8f8f8}
  .chat header .x{border:1px solid var(--line);padding:2px 6px;background:#fff;cursor:pointer;border-radius:2px;transition:background 0.2s ease}
  .chat header .x:hover{background:#f0f0f0}
  .chat main{padding:10px 12px;height:220px;overflow:auto;scroll-behavior:smooth}
  .msg{margin:6px 0;font:11px/1.4 Helvetica,Arial;word-wrap:break-word}
  .msg.you{color:var(--hair)}
  .msg.bot{color:var(--muted)}
  .msg.loading{color:var(--muted);opacity:0.6;animation:pulse 1.5s ease-in-out infinite}
  .chat footer{padding:8px 10px;border-top:1px solid var(--line);display:flex;gap:6px}
  .chat input{flex:1;border:1px solid var(--line);padding:6px 8px;font:inherit;border-radius:2px}
  .chat input:focus{border-color:#0ea5e9;outline:none}
  .chat button{border:1px solid var(--line);padding:6px 8px;background:#fff;cursor:pointer;border-radius:2px;transition:background 0.2s ease}
  .chat button:hover{background:#f8f8f8}

  .modal{position:fixed;inset:0;background:rgba(255,255,255,.95);display:none;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(4px)}
  .modal .panel{background:#fff;border:1px solid var(--line);padding:20px;min-width:280px;max-width:92vw;border-radius:8px;box-shadow:0 10px 40px rgba(0,0,0,0.1)}
  .modal .close{margin-top:16px;border:1px solid var(--line);background:#fff;padding:6px 10px;cursor:pointer;border-radius:2px;transition:background 0.2s ease}
  .modal .close:hover{background:#f8f8f8}
  .drop{border:1px dashed #ccc;padding:24px;text-align:center;cursor:pointer;border-radius:4px;transition:all 0.2s ease}
  .drop:hover{background:#fafafa;border-color:#999}

  .coach-strip{margin:24px 0 60px;border:1px solid var(--line);padding:6px 8px;display:flex;gap:8px;align-items:center;border-radius:4px;background:#fafafa}
  .coach-strip input{flex:1;border:1px solid var(--line);padding:6px 8px;font:inherit;border-radius:2px;background:#fff}
  .coach-strip input:focus{border-color:#0ea5e9;outline:none}
  .coach-strip span{color:var(--muted);font:11px/1 Helvetica,Arial;white-space:nowrap}

  .savebar{margin:80px 0 0;display:flex;gap:18px;flex-wrap:wrap}
  .btn{border:1px solid var(--line);padding:6px 10px;background:#fff;cursor:pointer;font:inherit;border-radius:2px;transition:all 0.2s ease}
  .btn:hover{background:#f8f8f8;transform:translateY(-1px)}
  .btn:focus{outline:2px solid #0ea5e9;outline-offset:2px}

  .formrow{margin:16px 0}
  .radio{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .radio label{display:flex;gap:6px;align-items:center;cursor:pointer;transition:color 0.2s ease}
  .radio label:hover{color:var(--muted)}
  .notice{position:fixed;left:20px;right:20px;bottom:16px;display:none;justify-content:space-between;gap:12px;background:#fff;border:1px solid var(--line);padding:8px 10px;z-index:1500;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
  .notice .btn{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:2px}

  .foot{border-top:1px solid var(--line);margin-top:140px;padding:14px 0;color:#777;font-size:12px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px}
  
  .status{display:inline-block;padding:2px 6px;font-size:10px;border-radius:12px;font-weight:500}
  .status.working{background:#e8f5e8;color:#2d6e2d}
  .status.error{background:#ffe8e8;color:#d63638}
  
  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }
  
  @media (max-width:860px){
    .metrics{grid-template-columns:1fr}
    .actions{flex-direction:column;align-items:flex-start}
    .radio{flex-direction:column;align-items:flex-start}
    .nav{gap:16px}
    .foot{flex-direction:column;text-align:center}
    .chat{width:280px;right:10px;bottom:10px}
  }
  
  @media (max-width:480px){
    .wrap{padding:20px 16px}
    .hero{margin:80px 0 30px}
    .coach-strip{flex-direction:column;gap:10px;align-items:stretch}
    .coach-strip input{width:100%}
    .actions .quiet{width:100%;text-align:center}
  }
  
  .tooltip{position:relative;cursor:help;color:var(--muted);border:1px solid var(--line);border-radius:50%;width:14px;height:14px;display:inline-flex;align-items:center;justify-content:center;font-size:9px;margin-left:4px}
  .tooltip:hover::after{content:attr(data-tip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:var(--fg);color:#fff;padding:8px 10px;border-radius:4px;font-size:11px;white-space:normal;max-width:200px;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
  .intro-process{margin:40px 0 60px;padding:20px;border:1px solid var(--line);border-radius:4px;background:#fafafa}
  .intro-process h2{margin:0 0 16px;font:600 14px/1.2 Helvetica,Arial}
  .process-steps{display:flex;gap:20px;margin:20px 0;flex-wrap:wrap}
  .step{flex:1;min-width:200px;padding:16px;border:1px solid var(--line);border-radius:4px;background:#fff}
  .step strong{display:block;margin-bottom:4px;color:var(--fg)}
  .step span{color:var(--muted);font-size:11px;line-height:1.4}
  .resource-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:30px;margin:20px 0}
  .resource-grid h4{margin:0 0 10px;font-size:12px;text-transform:uppercase;letter-spacing:0.05em}
  .resource-grid ul{list-style:none;padding:0;margin:0}
  .resource-grid li{margin:6px 0}
  .resource-grid a{color:var(--muted);font-size:11px;transition:color 0.2s ease}
  .resource-grid a:hover{color:var(--fg)}
  .help-section{margin:40px 0;padding:20px;border:1px solid var(--line);border-radius:4px}
  .help-section h3{margin:0 0 16px;font-size:14px}
  .process-flow{display:flex;align-items:center;gap:20px;margin:20px 0;flex-wrap:wrap}
  .flow-step{flex:1;min-width:200px;text-align:center}
  .step-number{width:40px;height:40px;border-radius:50%;background:var(--fg);color:#fff;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-weight:600}
  .step-content strong{display:block;margin-bottom:8px}
  .step-content p{margin:8px 0;color:var(--muted);font-size:12px}
  .step-content small{color:var(--muted);font-size:10px}
  .flow-arrow{font-size:24px;color:var(--muted)}
  .example-qa{margin:20px 0;padding:16px;border:1px solid var(--line);border-radius:4px}
  .question{font-weight:600;margin-bottom:8px;color:var(--fg)}
  .example-answer{color:var(--muted);font-style:italic;font-size:12px;line-height:1.5}
  .methodology-steps{margin:20px 0}
  .method-step{margin:20px 0;padding:16px;border-left:3px solid var(--line);padding-left:20px}
  .method-step strong{display:block;margin-bottom:8px;color:var(--fg)}
  .method-step p{margin:0;color:var(--muted);font-size:12px;line-height:1.5}
</style>

<div class="wrap">
  <nav class="nav">
    <a href="javascript:void(0)" onclick="scrollToSection('about')">about</a>
    <a href="javascript:void(0)" onclick="scrollToSection('modules')" title="Modules">modules</a>
    <a href="javascript:void(0)" onclick="scrollToSection('resources')" title="Help & Resources">resources</a>
    <a id="openUpload" href="javascript:void(0)" title="Upload a resume, image, or audio">upload</a>
    <a id="openChat" href="javascript:void(0)" title="Get help">help</a>
    <span class="status working" id="apiStatus">ready</span>
  </nav>

  <!-- INTRO SECTION -->
  <section class="intro-process">
    <h2>How This Works</h2>
    <p>Three simple steps to get unstuck in your career:</p>
    <div class="process-steps">
      <div class="step">
        <strong>1. Quick Questions</strong>
        <span>What's your situation? What do you want? What's blocking you?</span>
      </div>
      <div class="step">
        <strong>2. Explore Your Options</strong>
        <span>Look at jobs, improve your resume, make a plan</span>
      </div>
      <div class="step">
        <strong>3. Stay Moving</strong>
        <span>Check in weekly to keep making progress</span>
      </div>
    </div>
    <p><strong>Time needed:</strong> 15-30 minutes to start, then as needed</p>
  </section>

  <!-- USER INPUT -->
  <div class="coach-strip">
    <span>ask</span>
    <input id="coachAsk" placeholder="type a question or try: help me get started" autocomplete="off">
    <button id="voiceBtn" class="quiet" title="Voice input">🎤</button>
    <button id="coachSend" class="quiet" type="button">ask</button>
  </div>

  <!-- WELCOME / INTRO -->
  <section id="welcome" class="island" aria-label="Welcome">
    <div class="welcome-title" title="career clarity platform">what is my delta</div>
    <p class="sub" title="what this is">Feeling stuck in your career? Start with a few questions to get clear on what you want and how to get there.</p>
    <div class="actions">
      <button class="quiet" id="linkFast" title="guided route: key questions → action planning → progress tracking">start with questions</button>
      <button class="quiet" id="linkDiscover" title="explore different sections as you like">explore on my own</button>
      <button class="quiet" id="showJourney" title="show all sections">see everything</button>
      <button class="quiet" id="saveBtn" title="Save progress to file">save</button>
      <label class="quiet" for="loadFile" title="Load a saved file">load<input id="loadFile" type="file" accept="application/json" hidden></label>
    </div>
    <details class="micro"><summary>what's the difference?</summary>
      <small><strong>Start with questions:</strong> 5-10 minutes of guided questions to get clarity, then make a plan.<br>
      <strong>Explore on my own:</strong> Jump to any section - job search, resume work, or planning.</small>
    </details>
  </section>

  <header class="hero" id="top">
    <div class="title">WHAT IS MY DELTA</div>
    <p class="sub">Answer a few questions. Get clear on your next career move. Take action.</p>
  </header>

  <svg class="schema" viewBox="0 0 980 140" aria-hidden="true">
    <path class="wire" d="M120 90 H360 C400 90 420 78 450 70 C480 62 520 60 560 68 C600 76 640 60 700 58 C820 54 860 54 900 56"/>
    <circle class="dot" cx="120" cy="90" r="1.2"/>
  </svg>

  <div class="rule"></div>

  <section class="metrics" aria-label="Metrics">
    <div class="card"><div class="k">Clarity</div><div class="v" id="mClarity">75%</div></div>
    <div class="card"><div class="k">Action</div><div class="v" id="mAction">45%</div></div>
    <div class="card"><div class="k">Momentum</div><div class="v" id="mMomentum">32%</div></div>
  </section>

  <section id="modules" class="island" aria-label="Modules">
    <div class="module" id="ps101">
      <h3><a href="javascript:void(0)" onclick="scrollToSection('ps101')" title="open PS101">Get Started — Quick Questions</a></h3>
      <ul>
        <li>What's your current career challenge? <span class="tooltip" data-tip="Feeling stuck, want to change roles, looking for promotion, etc.">?</span></li>
        <li>What would success look like for you? <span class="tooltip" data-tip="New job, better pay, different industry, work-life balance, etc.">?</span></li>
        <li>What's your biggest obstacle right now? <span class="tooltip" data-tip="Time, skills, network, confidence, unclear direction, etc.">?</span></li>
      </ul>
      <textarea class="small" placeholder="write your thoughts as you work through these questions…" id="t_ps101" aria-label="Career questions notes"></textarea>
      <div class="module-actions">
        <a href="javascript:void(0)" data-prompt="help me get started with these questions">start here</a>
      </div>
    </div>
    
    <div class="module" id="progress">
      <h3><a href="javascript:void(0)" onclick="scrollToSection('progress')" title="open Progress">Stay on Track — Weekly Check-ins</a></h3>
      <ul>
        <li>Weekly progress review <span class="tooltip" data-tip="What got done, what didn't, what's working">?</span></li>
        <li>Action item tracking <span class="tooltip" data-tip="Specific next steps with deadlines">?</span></li>
        <li>Problem solving <span class="tooltip" data-tip="When you get stuck, work through obstacles">?</span></li>
      </ul>
      <textarea class="small" placeholder="what you're working on, what's working, what's stuck…" id="t_progress" aria-label="Progress notes"></textarea>
      <div class="module-actions">
        <a href="javascript:void(0)" data-prompt="help me figure out what to focus on this week">plan next steps</a>
      </div>
    </div>
    
    <div class="module" id="jobs">
      <h3><a href="javascript:void(0)" onclick="scrollToSection('jobs')" title="open Jobs">Job Search — Compare Opportunities</a></h3>
      <ul>
        <li>Compare different roles <span class="tooltip" data-tip="Side-by-side comparison of responsibilities, growth potential, company culture">?</span></li>
        <li>Skills alignment check <span class="tooltip" data-tip="How well your background matches what they're looking for">?</span></li>
        <li>Warning signs to watch <span class="tooltip" data-tip="Red flags: unrealistic requirements, vague job descriptions, high turnover, poor reviews">?</span></li>
      </ul>
      <textarea class="small" placeholder="job titles, companies, what interests you, what concerns you…" id="t_jobs" aria-label="Job search notes"></textarea>
      <div class="module-actions">
        <a href="javascript:void(0)" data-prompt="help me compare these job opportunities">compare jobs</a>
        <a href="javascript:void(0)" id="findJobs" title="Find relevant jobs">find jobs</a>
      </div>
    </div>
    
    <div class="module" id="resume">
      <h3><a href="javascript:void(0)" onclick="scrollToSection('resume')" title="open Resume">Resume — Tell Your Story</a></h3>
      <ul>
        <li>Highlight your best examples <span class="tooltip" data-tip="Pick 3-5 accomplishments that show results and growth">?</span></li>
        <li>Format for applications <span class="tooltip" data-tip="Clean, scannable format that works with applicant tracking systems">?</span></li>
        <li>Be truthful but compelling <span class="tooltip" data-tip="Honest about experience while presenting your strongest case">?</span></li>
      </ul>
      <textarea class="small" placeholder="your experiences, accomplishments, what you want to emphasize…" id="t_resume" aria-label="Resume notes"></textarea>
      <div class="module-actions">
        <a href="javascript:void(0)" data-prompt="help me write about this experience clearly">improve my resume</a>
      </div>
    </div>
    
    <div class="module" id="dashboard">
      <h3><a href="javascript:void(0)" onclick="scrollToSection('dashboard')" title="open Dashboard">Delta — Dashboard</a></h3>
      <ul><li>Clarity graph</li><li>Action trend</li><li>Next steps</li></ul>
      <textarea class="small" placeholder="next step (one thing to do)…" id="t_dashboard" aria-label="Dashboard notes"></textarea>
      <div class="module-actions">
        <a href="javascript:void(0)" data-prompt="suggest 1 next step from my notes">suggest next step</a>
      </div>
    </div>
  </section>

  <div class="rule"></div>

  <section id="resources" class="island" aria-label="Resources">
    <div class="welcome-title">Resources & Help</div>
    <div class="resource-grid">
      <div>
        <h4>Getting Started</h4>
        <ul>
          <li><a href="javascript:void(0)" onclick="scrollToSection('guide')">Complete User Guide</a></li>
          <li><a href="javascript:void(0)" onclick="scrollToSection('examples')">Example Questions & Answers</a></li>
          <li><a href="javascript:void(0)" onclick="alert('Career change tips: Focus on transferable skills, network actively, and take small steps toward your goal.')">Career Change Tips</a></li>
        </ul>
      </div>
      <div>
        <h4>Job Search</h4>
        <ul>
          <li><a href="javascript:void(0)" onclick="alert('Job boards: LinkedIn, Indeed, industry-specific sites like AngelList (tech), Idealist (nonprofits)')">Best Job Boards by Industry</a></li>
          <li><a href="javascript:void(0)" onclick="alert('Networking: Reach out with genuine interest, offer value first, follow up consistently')">Networking Templates</a></li>
          <li><a href="javascript:void(0)" onclick="alert('Interview prep: Research the company, prepare STAR method examples, ask thoughtful questions')">Interview Preparation</a></li>
        </ul>
      </div>
      <div>
        <h4>Resume & Applications</h4>
        <ul>
          <li><a href="javascript:void(0)" onclick="alert('Resume format: Clean layout, quantified achievements, ATS-friendly keywords')">Resume Templates</a></li>
          <li><a href="javascript:void(0)" onclick="alert('Cover letter: Address hiring manager by name, connect your experience to their needs, show enthusiasm')">Cover Letter Examples</a></li>
          <li><a href="javascript:void(0)" onclick="alert('Portfolio: Show your best work, include process/thinking, make it easy to navigate')">Portfolio Guidelines</a></li>
        </ul>
      </div>
    </div>
    
    <div id="guide" class="help-section">
      <h3>How This Platform Works</h3>
      <div class="process-flow">
        <div class="flow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <strong>Start with Questions</strong>
            <p>Answer 3 key questions about your career situation. This takes 5-10 minutes and gives you clarity on what you want.</p>
            <small>Time: 5-10 minutes</small>
          </div>
        </div>
        <div class="flow-arrow">→</div>
        <div class="flow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <strong>Explore Your Options</strong>
            <p>Use the tools to compare jobs, improve your resume, or plan next steps. Work on what feels most important.</p>
            <small>Time: 15-30 minutes</small>
          </div>
        </div>
        <div class="flow-arrow">→</div>
        <div class="flow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <strong>Stay on Track</strong>
            <p>Check in weekly to review progress and plan your next actions. Keep moving forward.</p>
            <small>Time: 10-15 minutes weekly</small>
          </div>
        </div>
      </div>
    </div>
    
    <div id="examples" class="help-section">
      <h3>Example Questions & Answers</h3>
      <div class="example-qa">
        <div class="question">What's your current career challenge?</div>
        <div class="example-answer">"I feel stuck in my current role. I've been doing the same work for 3 years and want to move into management, but don't know how to make the transition."</div>
      </div>
      <div class="example-qa">
        <div class="question">What would success look like for you?</div>
        <div class="example-answer">"Leading a small team, having more influence on project direction, and earning $20k more within 2 years."</div>
      </div>
      <div class="example-qa">
        <div class="question">What's your biggest obstacle right now?</div>
        <div class="example-answer">"I don't have management experience on my resume and don't know how to get it in my current company."</div>
      </div>
    </div>
  </section>
  
  <section id="about" class="island" aria-label="About">
    <div class="welcome-title">About What Is My Delta</div>
    <p>A practical career guidance platform designed to help you get unstuck and move forward in your career.</p>
    
    <h3>What This Platform Does</h3>
    <p>Instead of overwhelming you with generic career advice, we focus on three simple questions that cut through the noise:</p>
    <ul>
      <li><strong>What's your current challenge?</strong> - Get clear on what's actually blocking you</li>
      <li><strong>What would success look like?</strong> - Define your specific career goals</li>
      <li><strong>What's your biggest obstacle?</strong> - Identify what needs to change</li>
    </ul>
    
    <h3>The PS101 Methodology</h3>
    <p>Our approach is based on PS101 (Problem Solving 101) - a straightforward framework that prioritizes action over analysis paralysis:</p>
    <div class="methodology-steps">
      <div class="method-step">
        <strong>1. Clarity First</strong>
        <p>Start with honest self-assessment. No sugarcoating, no wishful thinking - just clear understanding of where you are.</p>
      </div>
      <div class="method-step">
        <strong>2. Practical Action</strong>
        <p>Focus on what you can actually do this week. Small, concrete steps that move you forward.</p>
      </div>
      <div class="method-step">
        <strong>3. Regular Check-ins</strong>
        <p>Weekly progress reviews to stay on track and adjust course when needed.</p>
      </div>
    </div>
    
    <h3>Why It Works</h3>
    <p>Most career advice tries to solve everything at once. We believe in tackling one clear problem at a time with specific, actionable steps. No fluff, no corporate speak - just practical guidance that fits into your real life.</p>
    
    <h3>Your Data, Your Control</h3>
    <p>Everything you enter stays on your device unless you choose to share it. You can save your progress, export your responses, or start fresh anytime. We're here to help you think through your career, not collect your data.</p>
    
    <h3>About Me</h3>
    <p>I'm Damian, founder of Alacrity Learning and Performance, and I built this platform after spending years helping people navigate career transitions. I've seen too many talented people get stuck - not because they lack skills or ambition, but because career advice often makes things more complicated than they need to be.</p>
    
    <p>The PS101 methodology came from working with hundreds of professionals who just needed a clear way to think through their next move. Instead of lengthy assessments or abstract frameworks, I wanted something practical: three questions that cut through the noise and get you moving forward.</p>
    
    <p>This isn't backed by venture capital or designed for massive scale. It's a straightforward tool for people who want to make thoughtful career decisions without the overwhelm. Your progress stays private, your data stays yours, and the focus remains on practical next steps rather than endless analysis.</p>
    
    <p>If you find this helpful, great. If not, no worries - there are many paths to career clarity, and this is just one approach that's worked for the people I've had the privilege to work with.</p>
    
    <h4>Get In Touch</h4>
    <p>Questions about the platform or want to share feedback? You can reach me at <span id="emailContact"></span> - I read every message and try to respond within a few days.</p>
    
    <div class="contact-form" style="margin-top:20px;padding:20px;border:1px solid var(--line);border-radius:4px;background:#fafafa">
      <h5 style="margin:0 0 16px;font-size:12px;text-transform:uppercase;letter-spacing:0.05em">Send a Message</h5>
      <form id="contactForm" name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field">
        <input type="hidden" name="form-name" value="contact">
        <div style="display:none">
          <label>Don't fill this out if you're human: <input name="bot-field"></label>
        </div>
        <div class="formrow">
          <label for="contactName" style="display:block;margin-bottom:4px;font-size:11px;color:var(--muted)">Name</label>
          <input type="text" id="contactName" required style="width:100%;padding:8px;border:1px solid var(--line);border-radius:2px;font:inherit">
        </div>
        <div class="formrow">
          <label for="contactEmail" style="display:block;margin-bottom:4px;font-size:11px;color:var(--muted)">Email</label>
          <input type="email" id="contactEmail" required style="width:100%;padding:8px;border:1px solid var(--line);border-radius:2px;font:inherit">
        </div>
        <div class="formrow">
          <label for="contactSubject" style="display:block;margin-bottom:4px;font-size:11px;color:var(--muted)">Subject</label>
          <select id="contactSubject" required style="width:100%;padding:8px;border:1px solid var(--line);border-radius:2px;font:inherit;background:#fff">
            <option value="">Choose a topic...</option>
            <option value="feedback">Platform Feedback</option>
            <option value="bug">Bug Report</option>
            <option value="question">General Question</option>
            <option value="partnership">Partnership/Collaboration</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="formrow">
          <label for="contactMessage" style="display:block;margin-bottom:4px;font-size:11px;color:var(--muted)">Message</label>
          <textarea id="contactMessage" required rows="4" style="width:100%;padding:8px;border:1px solid var(--line);border-radius:2px;font:inherit;resize:vertical"></textarea>
        </div>
        <div class="formrow" style="margin-top:16px">
          <button type="submit" class="quiet" style="padding:8px 16px">Send Message</button>
          <span id="contactStatus" style="margin-left:16px;font-size:11px"></span>
        </div>
      </form>
    </div>
  </section>
  
  <section id="privacy" class="island" aria-label="Privacy">
    <div class="welcome-title">Privacy Policy</div>
    <p>Your privacy is important to us. Here's what you need to know:</p>
    <ul>
      <li><strong>Data Storage:</strong> All your responses are saved locally in your browser. Nothing is sent to our servers unless you choose to submit feedback.</li>
      <li><strong>Optional Sharing:</strong> You can optionally contribute anonymous data to help improve the platform.</li>
      <li><strong>No Tracking:</strong> We don't use cookies or tracking pixels to monitor your behavior.</li>
      <li><strong>Your Control:</strong> You can export your data or delete it at any time using the save/load features.</li>
    </ul>
  </section>

  <!-- FEEDBACK -->
  <section id="feedback" class="island" aria-label="Feedback">
    <div class="welcome-title" title="tell us, briefly">feedback</div>
    <p class="sub">this helps us tune the welcome + flow. optional, quick.</p>

    <div class="formrow">
      <div class="k">intro clarity</div>
      <div class="radio">
        <label><input type="radio" name="fb_clarity" value="very clear"> very clear</label>
        <label><input type="radio" name="fb_clarity" value="somewhat"> somewhat</label>
        <label><input type="radio" name="fb_clarity" value="unclear"> unclear</label>
      </div>
    </div>

    <div class="formrow">
      <div class="k">felt welcomed</div>
      <div class="radio">
        <label><input type="radio" name="fb_welcome" value="yes"> yes</label>
        <label><input type="radio" name="fb_welcome" value="partly"> partly</label>
        <label><input type="radio" name="fb_welcome" value="not really"> not really</label>
      </div>
    </div>

    <div class="formrow">
      <div class="k">preferred path</div>
      <div class="radio">
        <label><input type="radio" name="fb_path" value="fast track"> fast track</label>
        <label><input type="radio" name="fb_path" value="discovery"> discovery</label>
        <label><input type="radio" name="fb_path" value="unsure"> unsure</label>
      </div>
    </div>

    <div class="formrow">
      <div class="k">one thing to improve</div>
      <textarea id="fb_comment" class="small" placeholder="tiny note…" aria-label="Feedback comment"></textarea>
    </div>

    <div class="actions" style="margin-top:20px">
      <button id="fbSubmit" class="quiet" title="download a copy + (optional) open SurveyMonkey">submit feedback</button>
    </div>
  </section>

  <div class="notice" id="saveNotice" aria-live="polite">
    <div>save before you leave?</div>
    <div style="display:flex;gap:8px">
      <button class="btn" id="noticeSave">save now</button>
      <button class="btn" id="noticeDismiss">dismiss</button>
    </div>
  </div>

  <footer class="foot">
    <div>What Is My Delta — A project by Alacrity Learning and Performance</div>
    <div>
      <a href="javascript:void(0)" onclick="scrollToSection('resources')">Help</a> · 
      <a href="javascript:void(0)" onclick="scrollToSection('privacy')">Privacy</a> · 
      <a href="javascript:void(0)" onclick="scrollToSection('feedback')">Feedback</a>
    </div>
  </footer>
</div>

<!-- CHAT -->
<aside class="chat" id="chat" role="dialog" aria-labelledby="chatTitle">
  <header>
    <div id="chatTitle">help</div>
    <button class="x" id="closeChat" title="Close" aria-label="Close help">×</button>
  </header>
  <main id="chatLog" aria-live="polite"></main>
  <footer>
    <input id="chatInput" placeholder="ask anything…" aria-label="help input" autocomplete="off">
    <button class="btn" id="sendMsg">ask</button>
  </footer>
</aside>

<!-- UPLOAD MODAL -->
<div class="modal" id="uploadModal" role="dialog" aria-labelledby="uploadTitle">
  <div class="panel">
    <h3 id="uploadTitle" style="margin-bottom:16px">Upload Files</h3>
    <div class="drop" id="dropZone">
      <div style="margin-bottom:10px">upload a resume, image, or audio</div>
      <input type="file" id="filePick" multiple accept=".pdf,.docx,.txt,.mp3,.wav,.jpg,.jpeg,.png">
      <div style="margin-top:8px;font-size:11px;color:var(--muted)">drag files here or click to select</div>
    </div>
    <div id="uploadStatus" style="margin-top:12px;display:none" aria-live="polite">
      <div style="font-size:11px;color:var(--muted)">uploading...</div>
    </div>
    <button class="close" id="closeUpload">close</button>
  </div>
</div>

<script>
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
  const API_BASE = 'https://mosaic-platform.vercel.app';
  
  // Load career coaching knowledge base + PS101 framework
  let careerPrompts = [];
  let ps101Framework = [];
  
  async function loadPrompts() {
    try {
      // Load 607 career coaching responses
      const csvResponse = await fetch('./assets/prompts.csv');
      const csvText = await csvResponse.text();
      const lines = csvText.split('\n').slice(1); // Skip header
      
      // Proper CSV parsing for CoachVox AI structure with embedded commas
      function parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim().replace(/^"|"$/g, ''));
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim().replace(/^"|"$/g, ''));
        return result;
      }
      
      careerPrompts = lines.filter(line => line.trim()).map(line => {
        const [prompt, completion, labels] = parseCSVLine(line);
        return { prompt, completion, labels };
      });
      
      // Load PS101 framework questions
      const ps101Response = await fetch('./data/prompts.ps101.json');
      const ps101Data = await ps101Response.json();
      ps101Framework = ps101Data.prompts;
      
      console.log(`Loaded ${careerPrompts.length} career coaching prompts + ${ps101Framework.length} PS101 framework questions`);
    } catch (error) {
      console.error('Failed to load prompt systems:', error);
    }
  }
  
  // Smart prompt matching
  function findBestMatch(userInput) {
    if (!careerPrompts.length) return null;
    
    const input = userInput.toLowerCase();
    let bestMatch = null;
    let highestScore = 0;
    
    careerPrompts.forEach(prompt => {
      let score = 0;
      const promptWords = prompt.prompt.toLowerCase().split(' ');
      const inputWords = input.split(' ');
      
      // Keyword matching
      inputWords.forEach(word => {
        if (promptWords.some(pw => pw.includes(word) || word.includes(pw))) {
          score += 1;
        }
      });
      
      // Exact phrase matching (higher weight)
      if (prompt.prompt.toLowerCase().includes(input)) {
        score += 10;
      }
      
      if (score > highestScore) {
        highestScore = score;
        bestMatch = prompt;
      }
    });
    
    return highestScore > 0 ? bestMatch : null;
  }

  $('#y').textContent = new Date().getFullYear();
  
  // Initialize prompts on page load
  loadPrompts();

  // API Status Check with improved error handling
  async function checkAPI() {
    try {
      const response = await fetch(`${API_BASE}/health`, { 
        method: 'GET',
        timeout: 5000 
      });
      if (response.ok) {
        const data = await response.json();
        if (data.ok) {
          $('#apiStatus').textContent = 'ready';
          $('#apiStatus').className = 'status working';
          return true;
        }
      }
      throw new Error('API not responding');
    } catch (error) {
      $('#apiStatus').textContent = 'offline';
      $('#apiStatus').className = 'status error';
      console.warn('API check failed:', error.message);
      return false;
    }
  }
  
  checkAPI();
  // Retry API check every 30 seconds if offline
  setInterval(() => {
    if ($('#apiStatus').className.includes('error')) {
      checkAPI();
    }
  }, 30000);

  // Enhanced Chat System with Real API Integration
  const chat = $('#chat');
  const chatLog = $('#chatLog');
  const chatInput = $('#chatInput');
  const sendMsg = $('#sendMsg');

  $('#openChat').addEventListener('click', e => {
    e.preventDefault(); 
    chat.style.display = 'block';
    chatInput.focus();
  });
  
  $('#closeChat').addEventListener('click', () => {
    chat.style.display = 'none';
  });

  // Close chat on Escape key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && chat.style.display === 'block') {
      chat.style.display = 'none';
    }
  });

  function addMsg(txt, who = 'you') {
    const div = document.createElement('div');
    div.className = `msg ${who}`;
    div.textContent = (who === 'you' ? '> ' : '') + txt;
    chatLog.appendChild(div);
    chatLog.scrollTop = chatLog.scrollHeight;
    
    // Announce new messages to screen readers
    if (who === 'bot') {
      div.setAttribute('aria-live', 'polite');
    }
  }

  async function askCoach(prompt) {
    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 15000); // 15s timeout
      
      const response = await fetch(`${API_BASE}/wimd`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: prompt.trim() }),
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();
      return data?.result?.message || data?.result || 'no response from coach';
    } catch (error) {
      if (error.name === 'AbortError') {
        return 'request timed out - please try again';
      }
      console.error('Coach API error:', error);
      return `connection issue (${error.message || 'unknown error'})`;
    }
  }

  async function send() {
    const v = chatInput.value.trim();
    if (!v) return;
    
    addMsg(v, 'you');
    chatInput.value = '';
    
    // Show loading with better UX
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'msg loading';
    loadingDiv.textContent = 'thinking...';
    chatLog.appendChild(loadingDiv);
    chatLog.scrollTop = chatLog.scrollHeight;
    
    try {
      const response = await askCoach(v);
      loadingDiv.remove();
      addMsg(response, 'bot');
    } catch (error) {
      loadingDiv.remove();
      addMsg('connection issue - please try again', 'bot');
    }
    
    softRoute(v);
  }

  chatInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  });
  
  sendMsg.addEventListener('click', send);

  // Enhanced Coach Strip (immediate input)
  const coachAsk = document.getElementById('coachAsk');
  const coachSend = document.getElementById('coachSend');

  async function sendStrip() {
    const v = (coachAsk.value || '').trim();
    if (!v) return;
    const chat = document.getElementById('chat');
    chat.style.display = 'block';
    addMsg(v, 'you');
    coachAsk.value = '';
    
    // Show loading
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'msg loading';
    loadingDiv.textContent = 'thinking...';
    const chatLog = document.getElementById('chatLog');
    chatLog.appendChild(loadingDiv);
    chatLog.scrollTop = chatLog.scrollHeight;
    
    // Try local CSV prompts first (607 career coaching responses)
    const match = findBestMatch(v);
    if (match) {
      loadingDiv.remove();
      addMsg(match.completion, 'bot');
    } else {
      // Fallback to API with PS101 framework context
      try {
        const response = await askCoach(v, ps101Framework);
        loadingDiv.remove();
        addMsg(response, 'bot');
      } catch (error) {
        loadingDiv.remove();
        addMsg('I understand you\'re looking for guidance. Could you try rephrasing your question? I work best with specific situations like "I feel stuck in my career" or "I don\'t know what I want to do."', 'bot');
      }
    }
    
    softRoute(v);
  }

  if (coachSend) {
    coachSend.addEventListener('click', (e) => {
      e.preventDefault();
      sendStrip();
    });
  }
  
  if (coachAsk) {
    coachAsk.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendStrip();
      }
    });
  }

  // First-visit gentle nudge with improved UX
  const SEEN = 'delta_seen_intro_v2';
  if (!localStorage.getItem(SEEN)) {
    setTimeout(() => {
      chat.style.display = 'block';
      addMsg('hi — want to start with some key questions or explore on your own?', 'bot');
      localStorage.setItem(SEEN, '1');
    }, 1000);
  }

  // Enhanced Upload with Real API Integration
  const modal = $('#uploadModal');
  const dropZone = $('#dropZone');
  const filePick = $('#filePick');
  const uploadStatus = $('#uploadStatus');

  $('#openUpload').addEventListener('click', e => {
    e.preventDefault();
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  });

  $('#closeUpload').addEventListener('click', closeUploadModal);

  function closeUploadModal() {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
    uploadStatus.style.display = 'none';
  }

  // Close modal on Escape key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && modal.style.display === 'flex') {
      closeUploadModal();
    }
  });

  // Enhanced file upload functionality
  async function uploadFile(file) {
    if (!file) return;
    
    // Validate file size (10MB limit)
    if (file.size > 10 * 1024 * 1024) {
      uploadStatus.style.display = 'block';
      uploadStatus.innerHTML = '<div style="font-size:11px;color:#d63638">file too large (max 10MB)</div>';
      return;
    }

    try {
      uploadStatus.style.display = 'block';
      uploadStatus.innerHTML = '<div style="font-size:11px;color:var(--muted)">uploading ' + file.name + '...</div>';

      const formData = new FormData();
      formData.append('file', file);
      formData.append('prompt', 'Please analyze this file and provide career coaching insights.');

      const response = await fetch(`${API_BASE}/wimd/upload`, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      const result = await response.json();
      
      uploadStatus.innerHTML = '<div style="font-size:11px;color:#2d6e2d">upload complete!</div>';
      
      // Add result to chat
      chat.style.display = 'block';
      addMsg(`uploaded: ${file.name}`, 'you');
      addMsg(result?.result?.message || result?.result || 'file processed', 'bot');
      
      // Close modal after delay
      setTimeout(() => {
        closeUploadModal();
      }, 2000);

    } catch (error) {
      uploadStatus.innerHTML = '<div style="font-size:11px;color:#d63638">upload failed: ' + (error.message || 'unknown error') + '</div>';
      console.error('Upload error:', error);
    }
  }

  filePick.addEventListener('change', async (e) => {
    const files = e.target.files;
    if (!files || files.length === 0) return;
    
    for (let file of files) {
      await uploadFile(file);
    }
  });

  // Enhanced drag and drop
  dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.style.background = '#f8f8f8';
    dropZone.style.borderColor = '#999';
  });

  dropZone.addEventListener('dragleave', (e) => {
    // Only reset if actually leaving the drop zone
    if (!dropZone.contains(e.relatedTarget)) {
      dropZone.style.background = '';
      dropZone.style.borderColor = '';
    }
  });

  dropZone.addEventListener('drop', async (e) => {
    e.preventDefault();
    dropZone.style.background = '';
    dropZone.style.borderColor = '';
    
    const files = e.dataTransfer.files;
    for (let file of files) {
      await uploadFile(file);
    }
  });

  // Enhanced Job Search Integration
  $('#findJobs').addEventListener('click', async (e) => {
    e.preventDefault();
    
    const jobsText = $('#t_jobs').value.trim();
    const query = jobsText || 'career opportunities';
    
    chat.style.display = 'block';
    addMsg(`finding jobs: ${query}`, 'you');
    
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'msg loading';
    loadingDiv.textContent = 'searching...';
    chatLog.appendChild(loadingDiv);
    chatLog.scrollTop = chatLog.scrollHeight;
    
    try {
      const response = await fetch(`${API_BASE}/jobsearch`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          query: query,
          location: 'Toronto, ON',
          max_results: 5
        })
      });

      loadingDiv.remove();

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      const result = await response.json();
      const jobsFound = result?.results?.length || 0;
      addMsg(`found ${jobsFound} opportunities. check your dashboard module for details.`, 'bot');
      
    } catch (error) {
      loadingDiv.remove();
      addMsg('job search temporarily unavailable', 'bot');
      console.error('Job search error:', error);
    }
  });

  // Enhanced Save / Load + Feedback + Leave Guard
  let dirty = false, savedThisSession = false;

  function markDirty() {
    dirty = true;
    $('#saveNotice').style.display = 'flex';
  }

  function collect() {
    return {
      version: '2.0',
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      metrics: {
        clarity: $('#mClarity').textContent,
        action: $('#mAction').textContent,
        momentum: $('#mMomentum').textContent
      },
      notes: {
        ps101: $('#t_ps101').value,
        coaching: $('#t_coaching').value,
        jobs: $('#t_jobs').value,
        resume: $('#t_resume').value,
        dashboard: $('#t_dashboard').value
      },
      feedback: collectFeedback()
    };
  }

  function collectFeedback() {
    const val = n => {
      const el = [...document.getElementsByName(n)].find(i => i.checked);
      return el ? el.value : '';
    };
    return {
      clarity: val('fb_clarity'),
      welcome: val('fb_welcome'),
      path: val('fb_path'),
      comment: $('#fb_comment').value
    };
  }

  function apply(data) {
    if (data?.metrics) {
      $('#mClarity').textContent = data.metrics.clarity || '75%';
      $('#mAction').textContent = data.metrics.action || '45%';
      $('#mMomentum').textContent = data.metrics.momentum || '32%';
    }
    if (data?.notes) {
      $('#t_ps101').value = data.notes.ps101 || '';
      $('#t_coaching').value = data.notes.coaching || '';
      $('#t_jobs').value = data.notes.jobs || '';
      $('#t_resume').value = data.notes.resume || '';
      $('#t_dashboard').value = data.notes.dashboard || '';
    }
    if (data?.feedback) {
      const set = (name, val) => {
        if (!val) return;
        const el = [...document.getElementsByName(name)].find(i => i.value === val);
        if (el) el.checked = true;
      };
      set('fb_clarity', data.feedback.clarity);
      set('fb_welcome', data.feedback.welcome);
      set('fb_path', data.feedback.path);
      $('#fb_comment').value = data.feedback.comment || '';
    }
  }

  function download(filename, obj) {
    try {
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
      savedThisSession = true;
      $('#saveNotice').style.display = 'none';
      dirty = false;
    } catch (error) {
      console.error('Download failed:', error);
      alert('Save failed - please try again');
    }
  }

  $('#saveBtn').addEventListener('click', () => download('delta-progress.json', collect()));

  $('#loadFile').addEventListener('change', (e) => {
    const f = e.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = () => {
      try {
        const data = JSON.parse(r.result);
        apply(data);
        alert('Progress loaded successfully');
      } catch (err) {
        alert('Invalid file format');
      }
    };
    r.onerror = () => alert('Failed to read file');
    r.readAsText(f);
  });

  // Enhanced auto-save and form tracking
  const formSelectors = ['#t_ps101', '#t_coaching', '#t_jobs', '#t_resume', '#t_dashboard', '#fb_comment'];
  formSelectors.forEach(sel => {
    const el = $(sel);
    if (el) {
      el.addEventListener('input', () => {
        markDirty();
        debounce(saveAuto, 1000)();
      });
    }
  });

  ['fb_clarity', 'fb_welcome', 'fb_path'].forEach(name => {
    document.getElementsByName(name).forEach(el =>
      el.addEventListener('change', () => {
        markDirty();
        debounce(saveAuto, 1000)();
      })
    );
  });

  // Debounce function for auto-save
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  const AUTO = 'delta_auto_v3';
  function saveAuto() {
    try {
      localStorage.setItem(AUTO, JSON.stringify(collect()));
    } catch (error) {
      console.warn('Auto-save failed:', error);
    }
  }

  (function loadAuto() {
    try {
      const data = JSON.parse(localStorage.getItem(AUTO) || '{}');
      if (Object.keys(data).length && data.version) {
        apply(data);
      }
    } catch (e) {
      console.warn('Auto-load failed:', e);
    }
  })();

  window.addEventListener('beforeunload', (e) => {
    if (dirty && !savedThisSession) {
      e.preventDefault();
      e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
    }
  });

  $('#noticeSave').addEventListener('click', () => download('delta-progress.json', collect()));
  $('#noticeDismiss').addEventListener('click', () => {
    $('#saveNotice').style.display = 'none';
    dirty = false;
  });

  // Enhanced feedback submission
  $('#fbSubmit').addEventListener('click', () => {
    try {
      const payload = {
        version: '2.0',
        timestamp: new Date().toISOString(),
        feedback: collectFeedback(),
        userAgent: navigator.userAgent
      };
      download('delta-feedback.json', payload);
      alert('Feedback saved! Thank you for helping us improve.');
    } catch (error) {
      console.error('Feedback submission failed:', error);
      alert('Failed to save feedback - please try again');
    }
  });

  // Enhanced smooth anchors + soft routing
  function smoothTo(id) {
    const el = $(id);
    if (el) {
      el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Focus management for accessibility
      if (el.tabIndex < 0) el.tabIndex = -1;
      el.focus();
    }
  }

  document.querySelectorAll('a[href^="#"]').forEach(a => {
    a.addEventListener('click', evt => {
      const href = a.getAttribute('href');
      if (href && href.length > 1) {
        evt.preventDefault();
        smoothTo(href);
      }
    });
  });

  function softRoute(txt) {
    const t = (txt || '').toLowerCase();
    if (t.includes('questions') || t.includes('fast')) smoothTo('#ps101');
    if (t.includes('explore') || t.includes('discover')) smoothTo('#modules');
    if (t.includes('dashboard')) smoothTo('#dashboard');
  }

  // Enhanced navigation links
  $('#showJourney').addEventListener('click', e => {
    e.preventDefault();
    smoothTo('#modules');
  });

  $('#linkFast').addEventListener('click', e => {
    e.preventDefault();
    smoothTo('#ps101');
  });

  $('#linkDiscover').addEventListener('click', e => {
    e.preventDefault();
    smoothTo('#modules');
  });

  // Enhanced ask coach module links
  document.querySelectorAll('[data-coach]').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const msg = a.getAttribute('data-coach');
      chat.style.display = 'block';
      chatInput.value = msg;
      chatInput.focus();
      send();
    });
  });

  // Performance monitoring
  if ('performance' in window) {
    window.addEventListener('load', () => {
      setTimeout(() => {
        const perfData = performance.timing;
        const loadTime = perfData.loadEventEnd - perfData.navigationStart;
        console.log(`Page loaded in ${loadTime}ms`);
      }, 0);
    });
  }

})();

  // Navigation scroll function
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });
      // If it's the feedback section, make sure it's visible
      if (sectionId === 'feedback') {
        section.style.display = 'block';
        section.style.visibility = 'visible';
      }
    }
  }

  // Make feedback section visible by default
  document.addEventListener('DOMContentLoaded', () => {
    const feedbackSection = document.getElementById('feedback');
    if (feedbackSection) {
      feedbackSection.style.display = 'block';
      feedbackSection.style.visibility = 'visible';
    }
  });

  // Enhanced API error handling
  const originalFetch = window.fetch;
  window.fetch = function(...args) {
    return originalFetch.apply(this, args)
      .catch(error => {
        console.warn('Network request failed:', error);
        // Show user-friendly error message
        const statusEl = document.getElementById('apiStatus');
        if (statusEl) {
          statusEl.textContent = 'working offline';
          statusEl.className = 'status error';
        }
        throw error;
      });
  };

  // Fix remaining data-coach references and add secondary link handlers
  document.addEventListener('DOMContentLoaded', () => {
    const coachElements = document.querySelectorAll('[data-coach]');
    coachElements.forEach(el => {
      const prompt = el.dataset.coach;
      el.dataset.prompt = prompt;
      delete el.dataset.coach;
    });
    
    // Fix data-prompt link handlers
    document.querySelectorAll('[data-prompt]').forEach(link => {
      link.addEventListener('click', async (e) => {
        e.preventDefault();
        const prompt = link.dataset.prompt;
        if (prompt) {
          const coachAsk = document.getElementById('coachAsk');
          const coachSend = document.getElementById('coachSend');
          
          // Set the prompt in the input field
          coachAsk.value = prompt;
          
          // Trigger the send function directly
          sendStrip();
        }
      });
    });
    
    // Fix resource section internal links
    const resourceLinks = document.querySelectorAll('#resources a[href^="#"]');
    resourceLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
    
    // Obfuscate email address to prevent spam bots
    const emailSpan = document.getElementById('emailContact');
    if (emailSpan) {
      // Obfuscated: hello@whatismydelta.com
      const parts = ['hello', 'whatismydelta', 'com'];
      const email = parts[0] + '@' + parts[1] + '.' + parts[2];
      emailSpan.innerHTML = `<a href="mailto:${email}">${email}</a>`;
    }
    
    // Handle contact form submission
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const statusSpan = document.getElementById('contactStatus');
        const submitBtn = contactForm.querySelector('button[type="submit"]');
        
        // Get form data
        const formData = {
          name: document.getElementById('contactName').value,
          email: document.getElementById('contactEmail').value,
          subject: document.getElementById('contactSubject').value,
          message: document.getElementById('contactMessage').value,
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          // BCC to your email
          bcc: 'damianseguin@gmail.com'
        };
        
        // Update UI
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        statusSpan.textContent = 'Sending message...';
        statusSpan.style.color = 'var(--muted)';
        
        try {
          // Send via Netlify Forms or your preferred service
          const response = await fetch('/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
              'form-name': 'contact',
              ...formData
            })
          });
          
          if (response.ok) {
            statusSpan.textContent = 'Message sent successfully!';
            statusSpan.style.color = 'green';
            contactForm.reset();
          } else {
            throw new Error('Network response was not ok');
          }
        } catch (error) {
          console.error('Contact form error:', error);
          statusSpan.textContent = 'Error sending message. Please try the email link above.';
          statusSpan.style.color = 'red';
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Send Message';
          
          // Clear status after 5 seconds
          setTimeout(() => {
            statusSpan.textContent = '';
          }, 5000);
        }
      });
    }
    
    // Voice input functionality
    const voiceBtn = document.getElementById('voiceBtn');
    const coachAsk = document.getElementById('coachAsk');
    
    if (voiceBtn && coachAsk && 'webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';
      
      let isListening = false;
      
      voiceBtn.addEventListener('click', () => {
        if (isListening) {
          recognition.stop();
          return;
        }
        
        recognition.start();
        isListening = true;
        voiceBtn.textContent = '⏹️';
        voiceBtn.title = 'Stop recording';
        coachAsk.placeholder = 'Listening...';
      });
      
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        coachAsk.value = transcript;
        
        // Auto-submit after voice input
        setTimeout(() => {
          sendStrip();
        }, 500);
      };
      
      recognition.onend = () => {
        isListening = false;
        voiceBtn.textContent = '🎤';
        voiceBtn.title = 'Voice input';
        coachAsk.placeholder = 'type a question or try: help me get started';
      };
      
      recognition.onerror = (event) => {
        console.warn('Speech recognition error:', event.error);
        isListening = false;
        voiceBtn.textContent = '🎤';
        voiceBtn.title = 'Voice input';
        coachAsk.placeholder = 'type a question or try: help me get started';
      };
    } else if (voiceBtn) {
      // Hide voice button if not supported
      voiceBtn.style.display = 'none';
    }
  });

</script>